---
title: |
  | P8160 - Project 3
  | Baysian modeling of hurrican trajectories
author: |
  | Amy Pitts, Jiacheng Wu, Jimmy Kelliher,
  | Ruiqi Yan & Tianchuan Gao
date: "2022-04-09"
output:
  beamer_presentation:
    colortheme: "dolphin"
header-includes:
- \usepackage{caption}
- \captionsetup[figure]{labelformat=empty}
---

```{r setup, include=FALSE}
library(ggplot2)
library(tidyverse)
library(data.table)
library(maps)
library(gtsummary)

dt = read.csv("hurrican703.csv")
load("df_rm.RData")
```

# Motivation

Climate researchers are interested in modeling the hurricane trajectories to forcase the windspeed.

## Data 

- **ID**: ID of hurricanes
- **Year**: In which the hurricane occurred
- **Month**: In which the hurricane occurred
- **Nature**: Nature of the hurricane
  - ET: Extra Tropical
  - DS: Disturbance
  - NR: Not Rated
  - SS: Sub Tropical
  - TS: Tropical Storm
- **Time**: dates and time of the record
- **Latitude** and **Longitude**: The location of a hurricane check point
- **Wind.kt**: Maximum wind speed (in Knot) at each check point


# Overview

- Exploration into the Data 
- Bayesian modeling of hurricane wind speed
  - Model Equation
  - Posterior Derivation 
  - MCMC Algorithm 
- How Month, Year, and the Nature of the hurricane affect wind speed
  - Explore seasonal differences
  - Explore if wind speeds is increasing over years
- Exploring wind speeds impact on death and damages
  - As well as the characteristic of a hurricane associated with damages and deaths


# Data 
```{r echo=FALSE, message=FALSE, warning=FALSE}
dt <- as.data.table(dt)
df_temp = dt %>%
  mutate(
    Nature = factor(Nature),
    Season = factor(Season), # season is year not season.... 
    #Month = factor(Month),
    Month = factor(Month, levels = c(month.name)),
  )

map <- ggplot(df_temp, aes(x = Longitude, y = Latitude, group = ID)) + 
  geom_polygon(
    data = map_data("world"), 
    aes(x = long, y = lat, group = group), 
    fill = "gray25", colour = "gray10", size = 0.2
  ) + 
  geom_path(data = df_temp, aes(group = ID, colour = Wind.kt), size = 0.5) + 
  xlim(-138, -20) + ylim(3, 55) + 
  labs(x = "", y = "", colour = "Wind \n(knots)") + 
  theme(panel.background = element_rect(fill = "gray10", colour = "gray30"),
        axis.text.x = element_blank(), axis.text.y = element_blank(), 
        axis.ticks = element_blank(), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank())

seasonrange <- paste(range(dt[, Season]), collapse=" - ")

mapMonth <- map + facet_wrap(~ Month) +
  ggtitle(paste("Atlantic named Windstorm Trajectories by Month (", 
                 seasonrange, ")\n")) 
mapMonth
```



# Data Cleaning 

- We are only concerned about observations that occurred on 6 hour intervals. hour 0, 6, 12, and 18. 
- In addition we will exclude all hurricane IDs that have less then 7 observations. 

Through this process we remove `r (dim(dt)[1]-dim(df_rm)[1])` observations so we are left with `r dim(df_rm)[1]` observations and `r length(unique(df_rm$ID))` unique hurricanes. 

# Bayesian Model for Hurricane Trajectories

To model the wind speed of the $i^{th}$ hurricane at time $t$ we will use
$$
Y_i(t+6) = \beta_{0,i}+\beta_{1,i}Y_i(t)+\beta_{2,i}\Delta_{i,1}(t)+\beta_{3,i}\Delta_{i,2}(t)+\beta_{4,i}\Delta_{i,3}(t) + \epsilon_i(t)
$$
Where 

- $\Delta_{i,1}(t)$, $\Delta_{i,2}(t)$ and $\Delta_{i,3}(t)$ are changes in latitude longitude and wind speed respectively between $t-6$ and $t$
- $\epsilon_i(t) \sim N(0, \sigma^2)$ independent across $t$
- Let $\beta_i = ( \beta_{0,i},  \beta_{1,i},  \beta_{2,i}, \beta_{3,i}, \beta_{4,i}) \sim \mathcal{N}(\mu, \Sigma)$ be multivariate normal distribution where $\mu \in \mathbb{R}^d$ and $\Sigma \in \mathbb{R}^{d \times d}$.

**Prior Distributions**: 

- For $\sigma^2$ we assume $\pi(\sigma^2) \propto \frac{1}{\sigma^2}$
- For $\mu$ we assume $\pi(\mu) \propto 1$
- For $\Sigma$ we assume $\pi\left(\Sigma^{-1}\right) \propto \left|\Sigma \right|^{-(d+1)}\exp\left\{ -\frac{1}{2} \Sigma^{-1}\right\}$


**Goal**: Estimate $\Theta = (\mu^T, \sigma^2, \Sigma)$

# Posterior Calculation


# MCMC Algorithm 


# Initial Starting Values


# MCMC Model Convergence 


# MCMC Model Convergence 


# Beta Estimates  


# Understanding Seasonal differnces in Hurricane Wind Speed


# Exploring if wind speeds has increased over the years


# Hurricane Deaths


# Hurricane Damages



# Conclusions 

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width = 8, fig.asp=0.8, fig.align='center'}
# figure
```
